<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sea to Summit – Summit</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen&display=swap" rel="stylesheet">

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

* {
  overscroll-behavior: none;
}

.app {
  position: fixed;
  inset: 0;
  background: black;
}

.stage-wrapper {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 1920px;
  height: 1080px;
}

.stage {
  position: relative;
  width: 1920px;
  height: 1080px;
}

.layer {
  position: absolute;
  inset: 0;
  width: 1920px;
  height: 1080px;
  image-rendering: pixelated;
  pointer-events: none;
}

.scene { z-index: 1; }
.frame { z-index: 10; }

.story {
  position: absolute;
  left: 50%;
  bottom: 180px;
  transform: translateX(-50%);
  width: 900px;
  font-family: "Silkscreen";
  font-size: 24px;
  line-height: 1.3;
  color: black;
  opacity: 0;
  transition: opacity 400ms ease;
  z-index: 25;
  user-select: none;
}

.story.visible { opacity: 1; }

.choices {
  position: absolute;
  left: 50%;
  bottom: 10px;
  transform: translateX(-50%);
  display: flex;
  gap: 80px;
  opacity: 0;
  transition: opacity 600ms ease;
  z-index: 30;
}

.choices.visible { opacity: 1; }

.button {
  position: relative;
  cursor: pointer;
}

.button img {
  width: 420px;
  image-rendering: pixelated;
}

.button span {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  font-family: "Press Start 2P";
  font-size: 18px;
  color: black;
  pointer-events: none;
}

.choice-link {
  text-decoration: none;
}

/* Mushroom hotspot – ONLY this area is clickable */
#mushroomLink {
  position: absolute;
  left: 1153px;
  top: 631px;
  width: 88px;
  height: 89px;
  z-index: 40;
  cursor: pointer;
  background-image: url("mushroom.png");
  background-repeat: no-repeat;
  background-size: 1920px 1080px;
  background-position: -1153px -631px;
}

/* White flash */
.flash {
  position: fixed;
  inset: 0;
  background: white;
  opacity: 0;
  pointer-events: none;
  z-index: 9999;
  transition: opacity 250ms ease;
}

.flash.on { opacity: 1; }

/* Shake effect */
@keyframes abductShake {
  0% { transform: translate(-50%, -50%); }
  25% { transform: translate(-50%, -50%) translate(6px, -4px); }
  50% { transform: translate(-50%, -50%) translate(-5px, 6px); }
  75% { transform: translate(-50%, -50%) translate(4px, -3px); }
  100% { transform: translate(-50%, -50%); }
}

.stage-wrapper.abducting {
  animation: abductShake 420ms linear;
}
</style>
</head>

<body>
<div class="app">

  <div class="stage-wrapper" id="stageWrapper">
    <div class="stage">
      <img class="layer scene" src="summit3i.png" alt="">
      <img class="layer frame" src="stsframe3.png" alt="">

      <div class="story" id="story"></div>

      <a id="mushroomLink" href="alien1.html" aria-label="Mushroom"></a>

      <div class="choices" id="choices">
        <a class="choice-link" href="end.html" data-choice="breath">
          <div class="button">
            <img src="stsbutton.png">
            <span>Take a deep breath</span>
          </div>
        </a>

        <a class="choice-link" href="end.html" data-choice="eyes">
          <div class="button">
            <img src="stsbutton.png">
            <span>Close your eyes</span>
          </div>
        </a>

        <a class="choice-link" href="end.html" data-choice="think">
          <div class="button">
            <img src="stsbutton.png">
            <span>Sit down and think</span>
          </div>
        </a>
      </div>
    </div>
  </div>

  <audio id="wind" src="wind.mp3" loop preload="auto"></audio>
  <div class="flash" id="flash"></div>

</div>

<script>
/* Prevent scrolling */
window.addEventListener("wheel", e => e.preventDefault(), { passive:false });
window.addEventListener("touchmove", e => e.preventDefault(), { passive:false });

/* Scaling */
const stageWrapper = document.getElementById("stageWrapper");
function scaleStage() {
  const s = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
  stageWrapper.style.transform = `translate(-50%, -50%) scale(${s})`;
}
window.addEventListener("resize", scaleStage);
scaleStage();

/* Wind continuation */
const wind = document.getElementById("wind");
const savedTime = localStorage.getItem("sts_wind_time");
if (savedTime) wind.currentTime = parseFloat(savedTime);
wind.volume = 0.35;
wind.play().catch(()=>{});

setInterval(() => {
  localStorage.setItem("sts_wind_time", wind.currentTime);
}, 300);

/* Story typing */
const story = document.getElementById("story");
const choices = document.getElementById("choices");

const lines = [
  "The light shifts around you, faint and strange, as if the island itself is watching.",
  "The stillness deepens, wrapping around your heartbeat.",
  "Whatever happens next begins with you."
];

let index = 0;
let typing = false;
let char = 0;
let timer;

function typeLine() {
  typing = true;
  char = 0;
  story.textContent = "";
  timer = setInterval(() => {
    char++;
    story.textContent = lines[index].slice(0, char);
    if (char >= lines[index].length) {
      clearInterval(timer);
      typing = false;
      if (index === lines.length - 1) {
        choices.classList.add("visible");
      }
    }
  }, 24);
}

document.addEventListener("click", (e) => {
  if (e.target.closest(".choice-link")) return;
  if (e.target.closest("#mushroomLink")) return;

  if (typing) {
    clearInterval(timer);
    story.textContent = lines[index];
    typing = false;
    if (index === lines.length - 1) choices.classList.add("visible");
    return;
  }

  if (index < lines.length - 1) {
    index++;
    typeLine();
  }
});

story.classList.add("visible");
typeLine();

/* Save ending choice */
document.querySelectorAll(".choice-link").forEach(btn => {
  btn.addEventListener("click", () => {
    localStorage.setItem("sts_end_choice", btn.dataset.choice);
  });
});

/* Mushroom abduction */
const mushroom = document.getElementById("mushroomLink");
const flash = document.getElementById("flash");

mushroom.addEventListener("click", e => {
  e.preventDefault();
  stageWrapper.classList.add("abducting");
  flash.classList.add("on");

  setTimeout(() => flash.classList.remove("on"), 250);
  setTimeout(() => window.location.href = mushroom.href, 520);
});
</script>
</body>
</html>
