<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sea to Summit, Uphill 3</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
  position: fixed;
  inset: 0;
}

* {
  overscroll-behavior: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

body { touch-action: manipulation; }

.app {
  position: fixed;
  inset: 0;
  background: black;
}

.stage-wrapper {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) scale(1);
  transform-origin: center center;
  width: 1920px;
  height: 1080px;
}

.stage {
  position: relative;
  width: 1920px;
  height: 1080px;
}

.layer {
  position: absolute;
  inset: 0;
  width: 1920px;
  height: 1080px;
  image-rendering: pixelated;
  pointer-events: none;
}

.scene { z-index: 1; }
.frame { z-index: 10; }

.story {
  position: absolute;
  left: 50%;
  bottom: 180px;
  transform: translateX(-50%);
  width: 900px;
  font-family: Silkscreen;
  font-size: 30px;
  line-height: 1.25;
  color: black;
  z-index: 25;
  min-height: 96px;
  padding: 16px 50px 0 50px;
  box-sizing: border-box;
  opacity: 0;
  transition: opacity 400ms ease;
}
.story.visible { opacity: 1; }

.button {
  position: relative;
  cursor: pointer;
  display: inline-block;
}
.button img {
  width: 420px;
  image-rendering: pixelated;
  pointer-events: none;
}
.button span {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  font-family: "Press Start 2P";
  font-size: 26px;
  letter-spacing: -1px;
  color: black;
  pointer-events: none;
  text-align: center;
  padding: 0 20px;
}

.continue-wrap {
  position: absolute;
  left: 50%;
  bottom: 5px;
  transform: translateX(-50%) scale(0.84);
  z-index: 40;
}

.choices {
  position: absolute;
  left: 50%;
  bottom: 5px;
  transform: translateX(-50%);
  display: flex;
  gap: 24px;
  z-index: 30;
  opacity: 0;
  pointer-events: none;
  transition: opacity 500ms ease;
}
.choices.visible {
  opacity: 1;
  pointer-events: auto;
}

.choice-link {
  text-decoration: none;
  transform: scale(0.84);
}
</style>
</head>

<body>
<div class="app">
  <div class="stage-wrapper" id="stageWrapper">
    <div class="stage">

      <img class="layer scene" src="uphill3i.png" alt="">
      <img class="layer frame" src="stsframe3.png" alt="">

      <div class="story" id="story"></div>

      <div class="continue-wrap" id="continueWrap">
        <div class="button" id="btnContinue">
          <img src="stsbutton.png" alt="">
          <span>Continue</span>
        </div>
      </div>

      <div class="choices" id="choices">
        <a class="choice-link" href="summit1.html" id="btnSlow">
          <div class="button">
            <img src="stsbutton.png" alt="">
            <span>Take it slow</span>
          </div>
        </a>

        <a class="choice-link" href="summit1.html" id="btnScramble">
          <div class="button">
            <img src="stsbutton.png" alt="">
            <span>Scramble up the rocks</span>
          </div>
        </a>
      </div>

    </div>
  </div>
</div>

<script>
/* Scale */
const stageWrapper = document.getElementById("stageWrapper");
function scaleStage() {
  const s = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
  stageWrapper.style.transform = "translate(-50%, -50%) scale(" + s + ")";
}
window.addEventListener("resize", scaleStage);
scaleStage();

/* Story */
const story = document.getElementById("story");
const btnContinue = document.getElementById("btnContinue");
const continueWrap = document.getElementById("continueWrap");
const choices = document.getElementById("choices");

const lines = [
  "The trail steepens as the summit draws closer.",
  "Loose stones shift beneath your feet.",
  "You feel the strain in your legs, and the wind presses harder.",
  "There are two ways forward."
];

let line = 0;
let char = 0;
let typing = null;

function typeLine() {
  if (typing) clearInterval(typing);
  story.textContent = "";
  char = 0;

  typing = setInterval(() => {
    char++;
    story.textContent = lines[line].slice(0, char);
    if (char >= lines[line].length) {
      clearInterval(typing);
      typing = null;
      if (line === lines.length - 1) showChoices();
    }
  }, 24);
}

function showChoices() {
  continueWrap.style.display = "none";
  choices.classList.add("visible");
}

function advanceStory() {
  if (typing) {
    clearInterval(typing);
    typing = null;
    story.textContent = lines[line];
    if (line === lines.length - 1) showChoices();
    return;
  }

  if (line < lines.length - 1) {
    line++;
    typeLine();
  }
}

btnContinue.addEventListener("pointerdown", (e) => {
  e.preventDefault();
  advanceStory();
}, { passive:false });

story.classList.add("visible");
typeLine();

/* POINTS + NAV (CRITICAL FIX) */
function addOnce(flag, key, amt) {
  if (localStorage.getItem(flag) === "1") return;
  const v = parseInt(localStorage.getItem(key) || "0", 10);
  localStorage.setItem(key, String(v + amt));
  localStorage.setItem(flag, "1");
}

function go(url) {
  window.location.href = url;
}

const btnSlow = document.getElementById("btnSlow");
const btnScramble = document.getElementById("btnScramble");

btnSlow.addEventListener("pointerdown", (e) => {
  e.preventDefault();
  e.stopPropagation();
  addOnce("sts_uphill3_slow", "sts_wisdom", 1);
  addOnce("sts_uphill3_slow_c", "sts_comfort", 1);
  go(btnSlow.getAttribute("href"));
}, { passive:false });

btnScramble.addEventListener("pointerdown", (e) => {
  e.preventDefault();
  e.stopPropagation();
  addOnce("sts_uphill3_scramble", "sts_courage", 1);
  go(btnScramble.getAttribute("href"));
}, { passive:false });
</script>
</body>
</html>
